@model LaundryShopSystem.Models.Transaction
@{
    ViewBag.Title = "Receipt";
    Layout = "~/Views/Shared/_Layout.cshtml"; // Optional: only if you have a layout
}

<div class="container py-5">
    <div class="card shadow-lg border-0 mx-auto" style="max-width:720px; border-radius: 16px;">
        <div class="card-body text-center">
            <h3 class="fw-bold text-primary mb-3">Laundry Receipt</h3>
            <p class="text-muted">Transaction #: <strong>@Model.TransactionId</strong></p>
            <p class="text-muted">Order #: <strong>@Model.OrderId</strong></p>
            <p class="fs-5 fw-semibold text-success mb-1">₱@Model.AmountPaid</p>
            <p class="text-secondary mb-3">@Model.PaymentMethod</p>
            <p class="small text-muted">@Model.PaidAt.ToString("yyyy-MM-dd HH:mm")</p>

            @* ---- QR Code Section ---- *@
            @{
                string qr = null;

                // Prefer Transaction.QRCodeUrl (new property), fallback to linked Order.QRCode
                var qrProp = Model.GetType().GetProperty("QRCodeUrl");
                if (qrProp != null)
                {
                    qr = qrProp.GetValue(Model)?.ToString();
                }
                else if (Model.Order != null)
                {
                    qr = Model.Order.QRCode;
                }
            }

            @if (!string.IsNullOrEmpty(qr))
            {
                <div class="mt-4">
                    <img src="@Url.Content(qr)" alt="QR Code"
                         class="img-fluid border p-2 shadow-sm rounded"
                         style="width:180px; height:180px; background:white;" />
                    <p class="mt-2 text-muted">Scan to track your order</p>
                </div>
            }
            else
            {
                <div class="border border-2 rounded py-4 mt-3 text-muted">
                    QR code not available
                </div>
            }

            @* ---- Actions ---- *@
            <div class="mt-4 d-flex justify-content-center gap-3">
                <button onclick="window.print()" class="btn btn-primary px-4">
                    <i class="bi bi-printer"></i> Print Receipt
                </button>
                <a href="/Orders/Track?token=@Model.OrderId" class="btn btn-outline-primary px-4">
                    <i class="bi bi-search"></i> Track Order
                </a>
            </div>
        </div>

        <div class="card-footer bg-light text-center small text-muted" style="border-radius: 0 0 16px 16px;">
            Thank you for trusting <strong>LaundryShopSystem</strong> 💧
        </div>
    </div>
</div>
